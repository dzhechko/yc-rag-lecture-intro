<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêç Python RAG –ü–µ—Å–æ—á–Ω–∏—Ü–∞ - Pyodide Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        .code-block {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            max-width: 100%;
        }
        .output-block {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #1e1e1e;
            color: #00ff00;
            padding: 1rem;
            border-radius: 0.5rem;
            max-height: 600px;
            overflow-y: auto;
            line-height: 1.4;
        }
        .pipeline-diagram {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div class="container mx-auto px-4 py-8">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-green-400 mb-2">
                <i class="fas fa-python mr-2"></i>Python RAG –ü–µ—Å–æ—á–Ω–∏—Ü–∞
            </h1>
            <div class="flex flex-wrap gap-2 mb-4">
                <span class="bg-green-600 text-white px-3 py-1 rounded-full text-sm">
                    <i class="fas fa-check-circle mr-1"></i>Python –≥–æ—Ç–æ–≤
                </span>
                <span id="sklearn-status" class="bg-yellow-600 text-white px-3 py-1 rounded-full text-sm loading">
                    <i class="fas fa-download mr-1"></i>–ó–∞–≥—Ä—É–∑–∫–∞ scikit-learn...
                </span>
                <span id="numpy-status" class="bg-yellow-600 text-white px-3 py-1 rounded-full text-sm loading">
                    <i class="fas fa-download mr-1"></i>–ó–∞–≥—Ä—É–∑–∫–∞ numpy...
                </span>
            </div>
            <p class="text-gray-400">
                <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
                –°–æ–≤–µ—Ç: –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –Ω–∏–∂–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å" –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤!
            </p>
        </div>

        <!-- –°—Ö–µ–º–∞ RAG Pipeline -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 text-blue-400">
                <i class="fas fa-diagram-project mr-2"></i>RAG Pipeline Architecture
            </h2>
            <div class="bg-gray-700 p-4 rounded-lg">
                <img src="https://page.gensparksite.com/v1/base64_upload/74eb3dafeee4379bd5c6c799e3f0314e" 
                     alt="RAG Pipeline Diagram" 
                     class="pipeline-diagram">
            </div>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="bg-gray-700 rounded p-3">
                    <h4 class="font-bold text-yellow-400 mb-2">üì• –≠—Ç–∞–ø –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (Steps 1-2):</h4>
                    <ul class="list-decimal list-inside text-gray-300 space-y-1">
                        <li><strong>Encode:</strong> –î–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä—ã —á–µ—Ä–µ–∑ Embedding Model</li>
                        <li><strong>Index:</strong> –í–µ–∫—Ç–æ—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Vector Database</li>
                    </ul>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <h4 class="font-bold text-green-400 mb-2">üîç –≠—Ç–∞–ø –ø–æ–∏—Å–∫–∞ (Steps 3-7):</h4>
                    <ul class="list-decimal list-inside text-gray-300 space-y-1" start="3">
                        <li><strong>Encode Query:</strong> –ó–∞–ø—Ä–æ—Å –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä</li>
                        <li><strong>Similarity Search:</strong> –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>
                        <li><strong>Retrieve:</strong> –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>
                        <li><strong>Prompt:</strong> –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º</li>
                        <li><strong>Generate:</strong> LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ö–æ–¥ -->
            <div class="bg-gray-800 rounded-lg p-4">
                <h2 class="text-xl font-semibold mb-3 text-blue-400">
                    <i class="fas fa-code mr-2"></i>–ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä RAG (Pyodide)
                </h2>
                <textarea id="codeInput" class="code-block w-full h-96 resize-none">
import numpy as np
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity
import textwrap

class SimpleRAG:
    """RAG —Å–∏—Å—Ç–µ–º–∞ —Å TF-IDF –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π"""
    
    def __init__(self):
        self.documents = []
        self.vectorizer = TfidfVectorizer()
        self.document_vectors = None
        
    def add_documents(self, docs):
        """–≠—Ç–∞–ø 1-2: Encode + Index –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
        self.documents = docs
        # –°–æ–∑–¥–∞–µ–º TF-IDF –≤–µ–∫—Ç–æ—Ä—ã (–∞–Ω–∞–ª–æ–≥ Embedding Model)
        self.document_vectors = self.vectorizer.fit_transform(docs)
        return len(docs)
    
    def search(self, query, k=2):
        """–≠—Ç–∞–ø—ã 3-5: Encode Query + Similarity Search + Retrieve"""
        if not self.documents:
            return []
        
        # –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
        query_vector = self.vectorizer.transform([query])
        
        # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
        similarities = cosine_similarity(query_vector, self.document_vectors)[0]
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø-k —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        top_indices = similarities.argsort()[-k:][::-1]
        
        results = []
        for idx in top_indices:
            if similarities[idx] > 0:
                results.append({
                    'document': self.documents[idx],
                    'score': float(similarities[idx]),
                    'index': idx + 1
                })
        
        return results
    
    def generate_answer(self, query, context_docs):
        """–≠—Ç–∞–ø—ã 6-7: Prompt + Generate Response (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)"""
        if not context_docs:
            return "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        context = "\n".join([doc['document'] for doc in context_docs])
        
        # –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
        if "rag" in query.lower():
            return "RAG (Retrieval-Augmented Generation) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤"
        elif "–±—ã—Å—Ç—Ä" in query.lower() or "–∞–ª–≥–æ—Ä–∏—Ç–º" in query.lower():
            return "HNSW –∏ FAISS –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞"
        else:
            return f"–ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: {context_docs[0]['document'][:100]}..."

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
print("üêç Python RAG –ü–µ—Å–æ—á–Ω–∏—Ü–∞ (Pyodide Edition)")
print("=" * 70)

rag = SimpleRAG()

# –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã
documents = [
    "RAG (Retrieval-Augmented Generation) –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤",
    "FAISS - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Facebook –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –≤–µ–∫—Ç–æ—Ä–∞–º",  
    "HNSW –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞",
    "–≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Ç–µ–∫—Å—Ç –≤ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞",
    "Recall@k –∏–∑–º–µ—Ä—è–µ—Ç –¥–æ–ª—é –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"
]

num_docs = rag.add_documents(documents)
print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {num_docs} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Vector Database")
print()

# –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å—ã
queries = [
    "–ß—Ç–æ —Ç–∞–∫–æ–µ RAG?",
    "–ö–∞–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π?"
]

for query in queries:
    print("=" * 70)
    print(f"üîç Query: '{query}'")
    
    # –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    results = rag.search(query, k=2)
    print(f"üìä –ù–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {len(results)}")
    
    for result in results:
        print(f"\n{result['index']}. (Score: {result['score']:.3f})")
        wrapped = textwrap.fill(result['document'], width=66)
        for line in wrapped.split('\n'):
            print(f"   {line}")
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    answer = rag.generate_answer(query, results)
    print(f"\nüí° Generated Response:")
    wrapped = textwrap.fill(answer, width=66)
    for line in wrapped.split('\n'):
        print(f"   {line}")
    print()

print("=" * 70)
print("‚úÖ Pipeline completed successfully!")
                </textarea>
                <div class="mt-4 flex gap-3">
                    <button id="runButton" onclick="runCode()" disabled class="bg-gray-600 text-white px-6 py-2 rounded-lg transition opacity-50 cursor-not-allowed">
                        <i class="fas fa-spinner fa-spin mr-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫...
                    </button>
                    <button onclick="resetCode()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg transition">
                        <i class="fas fa-undo mr-2"></i>–°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <div class="bg-gray-800 rounded-lg p-4">
                <h2 class="text-xl font-semibold mb-3 text-green-400">
                    <i class="fas fa-terminal mr-2"></i>–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                </h2>
                <div id="output" class="output-block">
                    <span class="text-yellow-400">‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Pyodide...</span>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö -->
        <div class="mt-6 bg-gray-800 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-3 text-yellow-400">
                <i class="fas fa-info-circle mr-2"></i>–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="bg-gray-700 rounded p-3">
                    <h4 class="font-bold text-green-400 mb-2">üêç Pyodide</h4>
                    <p class="text-gray-300">Python 3.11 –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–∞—É—á–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫</p>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <h4 class="font-bold text-blue-400 mb-2">üìä Scikit-learn</h4>
                    <p class="text-gray-300">TF-IDF –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ</p>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <h4 class="font-bold text-purple-400 mb-2">üî¢ NumPy</h4>
                    <p class="text-gray-300">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ –∏ –º–∞—Ç—Ä–∏—Ü–∞–º–∏</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pyodide = null;
        const originalCode = document.getElementById('codeInput').value;

        async function main() {
            const outputEl = document.getElementById('output');
            outputEl.innerHTML = '<span class="text-yellow-400">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞...</span>';
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ Pyodide
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
            });
            
            outputEl.innerHTML = '<span class="text-yellow-400">üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤...</span>';
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
            await pyodide.loadPackage(["numpy", "scikit-learn"]);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
            document.getElementById('sklearn-status').className = 'bg-green-600 text-white px-3 py-1 rounded-full text-sm';
            document.getElementById('sklearn-status').innerHTML = '<i class="fas fa-check-circle mr-1"></i>scikit-learn –≥–æ—Ç–æ–≤';
            
            document.getElementById('numpy-status').className = 'bg-green-600 text-white px-3 py-1 rounded-full text-sm';
            document.getElementById('numpy-status').innerHTML = '<i class="fas fa-check-circle mr-1"></i>numpy –≥–æ—Ç–æ–≤';
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            const runBtn = document.getElementById('runButton');
            runBtn.disabled = false;
            runBtn.className = 'bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition';
            runBtn.innerHTML = '<i class="fas fa-play mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥';
            
            outputEl.innerHTML = '<span class="text-green-400">‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É! –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥"</span>';
        }

        async function runCode() {
            if (!pyodide) return;
            
            const code = document.getElementById('codeInput').value;
            const outputEl = document.getElementById('output');
            
            try {
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ stdout
                pyodide.runPython(`
                    import sys
                    from io import StringIO
                    sys.stdout = StringIO()
                `);
                
                // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
                pyodide.runPython(code);
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞
                const output = pyodide.runPython("sys.stdout.getvalue()");
                outputEl.textContent = output;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                outputEl.classList.add('animate-pulse');
                setTimeout(() => outputEl.classList.remove('animate-pulse'), 500);
                
            } catch (error) {
                outputEl.innerHTML = `<span class="text-red-400">‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>\n<span class="text-red-300">${error}</span>`;
            }
        }

        function resetCode() {
            document.getElementById('codeInput').value = originalCode;
            document.getElementById('output').innerHTML = '<span class="text-green-400">‚úÖ –ö–æ–¥ —Å–±—Ä–æ—à–µ–Ω. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥"</span>';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main();
    </script>
    
    <!-- Footer —Å Telegram —Å—Å—ã–ª–∫–æ–π -->
    <div class="fixed bottom-4 right-4 z-50">
        <a href="https://t.me/llm_notes" class="inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg transition-all transform hover:scale-105">
            <i class="fab fa-telegram mr-2"></i>
            Telegram
        </a>
    </div>
    
    <!-- Home button -->
    <div class="fixed bottom-4 left-4 z-50">
        <a href="index.html" class="inline-flex items-center bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow-lg transition-all transform hover:scale-105">
            <i class="fas fa-home mr-2"></i>
            –ì–ª–∞–≤–Ω–∞—è
        </a>
    </div>
</body>
</html>